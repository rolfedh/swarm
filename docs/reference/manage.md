<!--[metadata]>
+++
title = "manage"
description = "Create a Swarm manager."
keywords = ["swarm, create, manage"]
[menu.main]
identifier="swarm.manage"
parent="smn_swarm_subcmds"
+++
<![end-metadata]-->

# manage

Prerequisite: Before using `manage` to create a Swarm manager, establish a discovery backend as described in [this discovery topic](../discovery.md).

The `manage` command creates a Swarm manager whose purpose is to receive commands on behalf of the cluster and assign containers to Swarm nodes. You can create multiple Swarm managers as part of a high-availability cluster.

## Syntax

    $ docker run swarm manage [OPTIONS] <discovery>

For example, to create a primary manager in a high-availability Swarm cluster:

    $ docker run -d -p 4000:4000 swarm manage -H :4000 --replication --advertise 172.30.0.161:4000  consul://172.30.0.165:8500

Where the following items configure the Swarm manager to:
* `-H :4000`: Listen for incoming messages using the default network interface and port 4000.
* `--replication`: Copy its failover data to the other managers.  
* `--advertise 172.30.0.161:4000`: Advertise its IP address and port number to other swarm managers.
* `consul://172.30.0.165:8500`: Notify the consul discovery backend that it is a member of the cluster.

For example, to create a Swarm manager that uses Transport Layer Security (TLS):

    $ docker run -d -p 3376:3376 -v /home/ubuntu/.certs:/certs:ro swarm manage --tlsverify --tlscacert=/certs/ca.pem --tlscert=/certs/cert.pem --tlskey=/certs/key.pem --host=0.0.0.0:3376 token://$TOKEN


## Input Arguments

### `<discovery>` — discovery backend

Before you can create a Swarm manager, get a discovery token from an existing discovery backend, or create a discovery backend. Then, use the `discovery` argument to specify that token or the discovery backend nodes. The environment variable `<discovery>` sets is `$SWARM_DISCOVERY`.

For more information and examples, see the [Docker Swarm Discovery](../discovery.md) topic.

For the `<discovery>` argument, enter one of the following values:

* `token://<token>`
* `consul://<ip1>/<path>`
* `etcd://<ip1>,<ip2>,<ip2>/<path>`
* `file://<path/to/file>`
* `zk://<ip1>,<ip2>/<path>`
* `[nodes://]<iprange>,<iprange>`

Where:

* `<token>` is a discovery token generated by the Docker Hub Hosted Discovery Service. To generate this discovery token, use the [`create`](create.md) command.
> Warning: The Docker Hub Hosted Discovery Service is not recommended for production use. It’s intended to be used for testing/development. See the discovery backends for production use.

* `ip1`, `ip2`, `ip3` are each the IP address and port numbers of a discovery backend node.
* `path` (optional) specifies a path to a key-value store on the discovery backend. For example, to maintain multiple distinct key-value stores on one backend, use separate paths for each one.
* `path/to/file` is the path to a file that contains a static list of the Swarm managers and nodes that are members the cluster.
* `iprange` is a range of IP addresses followed by a port number

## Options

### `--strategy "<value>"` — scheduler placement strategy
Tells Docker Swarm scheduler which placement strategy to use, where `<value>` is one of the following:
  * `spread` — Assigns each container to the Swarm node with the most free resources. If you do not use the `--strategy` option, the scheduler applies the spread strategy.
  * `binpack` - Assigns containers to one Swarm node until it is full before assigning them to another one.
  * `random` - Assigns each container to a random Swarm node.

For more information and examples, see [Docker Swarm strategies](../scheduler/strategy.md).

### `--filter <value>` or `-f <value>` — scheduler filter
Tells Docker Swarm scheduler which nodes to use when creating and running a container.

Where `<value>` is:
  * `health` — Use nodes that are running and communicating with the discovery backend.
  * `port` — For containers that have a static port mapping, use nodes whose corresponding port number is available (i.e., not occupied by another container or process).
  * `dependency` — For containers that have a declared dependency, use nodes that already have a container with the same dependency.
  * `affinity` — For containers that have a declared affinity, use nodes that already have a container with the same affinity.
  * `constraint` — For containers that have a declared constraint, use nodes that already have a container with the same constraint.

You can use multiple scheduler filters, like this:

`--filter <value> --filter <value>`

For more information and examples, see [Swarm filters](../scheduler/filters.md).

### `--host <ip>:<port>` or `-H <ip>:<port>` — listen to IP/socket
Specify the IP address and port number to which the manager listens for incoming messages. If you omit `<ip>`, the manager uses the default host IP.

The environment variable `--host` sets is `$SWARM_HOST`.
<TBD - or is it the other way around? Can you assign the value of the environment variables to the options? >

### `--replication` — Enable Swarm manager replication
Enable Swarm manager replication between the *primary* and *replica* managers in a high-availability cluster. Replication mirrors <TBD> information from the primary to the replica managers so that, if the primary manager fails, a replica can become primary.  

### `--replication-ttl "<delay>s"` — Leader lock release time on failure
Specify the delay, in seconds, before notifying replica managers that the primary manager is down or unreachable. This notification triggers an election in which one of the replica managers becomes the primary manager. If you don't specify this option, the default delay is 15 seconds.

### `--advertise <ip>:<port>` or `--addr <ip>:<port>` — Advertise manager's IP and port number
Advertise the IP address and port number of the Swarm manager that's joining the cluster. Other swarm managers MUST be able to reach this swarm manager at this address.

The environment variable `--advertise` sets is `$SWARM_ADVERTISE`.

$ docker run -d -p 3376:3376 -v /home/ubuntu/.certs:/certs:ro swarm manage --tlsverify --tlscacert=/certs/ca.pem --tlscert=/certs/cert.pem --tlskey=/certs/key.pem --host=0.0.0.0:3376 token://$TOKEN

### `--tls` — use TLS
Use transport layer security (TLS). If you use `--tlsverify`, you do not need to use `--tls`.

### `--tlscacert=<path/file>` — specify a CA's public key
Specify the path and file name of the public key (certificate) from a Certificate Authority (CA). When specified, the manager trusts only remotes that provide a certificate signed by the same CA. For example: `--tlscacert=/certs/ca.pem`.

### `--tlscert` — path to TLS certificate file
Specify the path and file name of the manager's certificate (signed by the CA). For example, `--tlscert=/certs/cert.pem`.

### `--tlskey` — path to TLS key file
Specify the path and file name of the manager's private key (signed by the CA). For example, `--tlskey=/certs/key.pem`.

### `--tlsverify` — use TLS and verify the remote
Enable transport layer security (TLS) and verify the remote using TLS. If you use `--tlsverify`, you do not need to use `--tls`.

### `--engine-refresh-min-interval "<interval>s"` — set engine refresh minimum interval
Specify the minimum interval, in seconds, between Engine refresh. If you don't specify this option, the default interval is 30 seconds.

### `--engine-refresh-max-interval "<interval>s"` — set engine refresh maximum interval
Specify the minimum interval, in seconds, between Engine refresh. If you don't specify this option, the default interval is 60 seconds.

### `--engine-failure-retry "<number>"` — set engine failure retry count
Specify the number of retries to attempt if the engine fails. If you don't specify this option, the default number is 3 retries.

### `--engine-refresh-retry "<number>"` — deprecated
Deprecated; replaced by `--engine-failure-retry`. The default number is 3 retries.

### `--heartbeat "<interval>s"` — period between each heartbeat
Specify the interval, in seconds, between heartbeats. If you don't specify this option, the default interval is 60 seconds.

### `--api-enable-cors` or `--cors` — enable CORS headers in the remote API
Enable enable CORS headers in the remote API.

### `--cluster-driver "<driver>"` or `-c "<driver>"` — cluster driver to use
Specify a cluster driver to use. Where `<driver>` is one of the following:
* `swarm` is the Docker Swarm driver.
* `mesos-experimental` is the Mesos cluster driver.

If you do not use this option, the default driver is `swarm`.

For more information about using Mesos driver, see [Using Docker Swarm and Mesos](https://github.com/docker/swarm/blob/master/cluster/mesos/README.md).

### `--cluster-opt` — cluster driver options

You can enter multiple cluster driver options, like this:

`--cluster-opt <value> --cluster-opt <value>`

Where `<value>` is one of the following:
  * `swarm.overcommit=0.05` — overcommit to apply on resources
  * `swarm.createretry=0` — container create retry count after initial failure
  * `mesos.address=` — address to bind on. This option sets the value of the   `$SWARM_MESOS_ADDRESS` environment variable.
  * `mesos.checkpointfailover=false` — checkpointing allows a restarted slave to reconnect with old executors and recover status updates, at the cost of disk I/O. This option sets the value of the `$SWARM_MESOS_CHECKPOINT_FAILOVER` environment variable.
  * `mesos.port=` — port to bind on. This option sets the value of the   `$SWARM_MESOS_PORT` environment variable.
  * `mesos.offertimeout=30s` — timeout for offers. This option sets the value of the `$SWARM_MESOS_OFFER_TIMEOUT` environment variable.
  * `mesos.offerrefusetimeout=5s` — seconds to consider unused resources refused. This option sets the value of the `$SWARM_MESOS_OFFER_REFUSE_TIMEOUT` environment variable.
  * `mesos.tasktimeout=5s` — timeout for task creation. This option sets the value of the `$SWARM_MESOS_TASK_TIMEOUT` environment variable.
  * `mesos.user=` — framework user. This option sets the value of the `$SWARM_MESOS_USER` environment variable.

### `--discovery-opt` — discovery options
Specify discovery options, such as paths to the CA certificate, certificate, and private key of the distributed k/v store on a Consul or etcd discovery backend. 

For more information, see [Use TLS with distributed key/value discovery](../discovery.md/#use-tls-with-distributed-key-value-discovery)

You can enter multiple discovery options, like this:

`--discovery-opt <value> --discovery-opt <value>`

For example:

    --discovery-opt kv.cacertfile=/path/to/mycacert.pem \
    --discovery-opt kv.certfile=/path/to/mycert.pem \
    --discovery-opt kv.keyfile=/path/to/mykey.pem \
